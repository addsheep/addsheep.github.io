<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  
  <script>const KEY = "fdf0a6e7f06f49d3b343706a36ba1a3b"
function main() {
  fetch('https://tavusapi.com/v2/conversations',
        {
          method: 'GET',
          headers: {"x-api-key": KEY}
        })
    .then(response => response.json())
    .then(response => {
      console.log(response)
      var url = findActive(response.data)
      if (url != null) {
        updateUrl(url)
      } else {
        create()
      }
    })
    .catch(err => console.error(err));
}

function findActive(data) {
  for (const obj of data) {
    if (obj.status == "active") {
      return obj.conversation_url
    }
  }
  return null
}

function updateUrl(url) {
  document.getElementById("_iframe").src = url
}

function create() {
  const options = {
  method: 'POST',
  headers: {'x-api-key': KEY, 'Content-Type': 'application/json'},
  body: '{"replica_id":"rb17cf590e15","persona_id":"p732fe31006f","conversation_name":"A meeting with the patient","conversational_context":"you are about to meet your patient for a regular health checkup. you should ask about their physical and mental status and give personalized advice"}'
};

fetch('https://tavusapi.com/v2/conversations', options)
  .then(response => response.json())
  .then(response => {
    updateUrl(response.conversation_url)
  })
  .catch(err => console.error(err));
}
  </script>
</head>
<body>
  <button onclick="main()">Click Me</button>
  <div>
    <iframe id="_iframe" allow="camera;microphone" width="100%" height="1024px"></iframe>
  </div>
</body>
</html>
